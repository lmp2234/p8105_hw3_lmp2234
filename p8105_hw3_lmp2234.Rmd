---
title: "p8105_hw3_lmp2234"
author: "Lisa Pardee"
date: "2024-10-16"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r}
library(p8105.datasets)
data("ny_noaa")

summary(ny_noaa)
dim(ny_noaa)

sum(is.na(ny_noaa))
colSums(is.na(ny_noaa))

total_obs<-nrow(ny_noaa)

missing_sum <-data.frame(
  variable = colnames(ny_noaa), 
  missing_values = colSums(is.na(ny_noaa)), 
  missing_percentage = (colSums(is.na(ny_noaa)) / total_obs) * 100 ) 

missing_sum<-missing_sum[missing_sum$missing_values >0, ]
missing_sum


```
The data set provides weather data and contains `r nrow(ny_noaa)` observations and `r ncol(ny_noaa)` variables.The variables named are weather station id (id), date of observation (date), precipitation (prcp) snowfall (snow), snow depth (snwd), maximum temperature (tmax), and minimum temperature (tmin). There is a total of 3387623 missing data values. The variables that have missing data are prcp, snow, snwd, tmax, and tmin. There is a very large portion of missing data for minimum and maximum data, and much missing data for snow and snwd. Overall, this dataset has a substantial portion of missing data. 

#Data Cleaning 
```{r}
library(janitor)
library(dplyr)
library(lubridate)
ny_noaa <- ny_noaa %>%
  clean_names() %>%
  mutate(
    prcp = as.numeric(prcp),
    tmax = as.numeric(tmax),
    tmin = as.numeric(tmin),
    snow = as.numeric(snow),
    snwd = as.numeric(snwd),
    year = year(ymd(date)),
    month = month(ymd(date)),
    day = day(date), 
    prcp = prcp / 10, 
    tmax = tmax / 10, 
    tmin = tmin / 10
  )
  
snowfall_common <-ny_noaa %>%
  filter(snow>0) %>%
  count(snow)%>%
  arrange(snow)

top_n<-5

top_snowfall <- head(snowfall_common, n = top_n) 
top_snowfall


```
For snowfall, the most commonly observed values are for the smallest recorded snow fall in mm. These are expected to be the most common, because this amount of snowfall is more likely to occur as compared to more extreme weather events that occur more rarely. 

```{r}

library(ggplot2)
library(patchwork)

avg_temp <- ny_noaa %>%
  filter(month %in% c(1, 7)) %>%  
  group_by(id, year, month) %>%  
  summarize(avg_tmax = mean(tmax, na.rm = TRUE), .groups = 'drop')  


ggplot(avg_temp, aes(x = as.factor(month), y = avg_tmax, fill = as.factor(month))) +
  geom_boxplot() +
  scale_fill_manual(values = c("blue", "red"), 
                    labels = c("January", "July")) +
  labs(title = "Boxplot of Average Max Temperatures in January and July", 
       x = "Month", 
       y = "Average Max Temperature (°C)", 
       fill = "Month") +
  theme_minimal()
```

The plots for both January and July appear approximately normally distributed. The average max temperatures are higher July (median of 27 degrees Celsius), compared to January (median of 0 degrees Celsius), which is expected. There is less variability in temperatures for July since the size of the box (i.e., interquartile range) is smaller compared to the box for January. There is more variability in extreme temperature values in January since the whiskers are longer. There apepars to be a few outliers in box January and July which indicate the presence of extreme weather events. 

```{r}
library(tidyverse)
library(ggridges)
library(patchwork)


density_plot<-ggplot(ny_noaa, aes(x = tmax, y = tmin)) +
  geom_density_2d_filled(alpha = 0.5) +
  labs(title = "Density Plot of Max vs Min Temperature",
       x = "Max Temperature (°C) Bins",
       y = "Min Temperature (°C)") +
  theme_minimal()

box_plot <- ggplot(ny_noaa, aes(x = tmax_bin, y = tmin)) +
  geom_boxplot() +
  labs(title = "Box Plot of Min Temperature by Binned Max Temperature",
       x = "Max Temperature (°C) Bins",
       y = "Min Temperature (°C)") +
  theme_minimal()

combined_plot <- density_plot + box_plot

print(combined_plot)

```

```{r}
filtered_snow <- ny_noaa %>%
  filter(snow > 0 & snow < 100)


snowfall_plot_violin <- ggplot(filtered_snow, aes(x = factor(year), y = snow, fill = factor(year))) +
  geom_violin(alpha = 0.7) +
  labs(title = "Distribution of Snowfall Values (0 < snow < 100) by Year",
       x = "Year",
       y = "Snowfall (mm)",
       fill = "Year") +
  theme_minimal() +
  theme(legend.position = "none")


print(snowfall_plot_violin)
```

